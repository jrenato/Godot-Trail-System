[gd_scene load_steps=10 format=3 uid="uid://dx1k7tweotcvd"]

[ext_resource type="ArrayMesh" uid="uid://h6lgvku4jcvq" path="res://assets/projectile_shape_1.obj" id="1"]
[ext_resource type="Texture2D" uid="uid://di2kpkq6emdy1" path="res://assets/tex_1.png" id="2"]
[ext_resource type="Script" path="res://addons/Trail/trail_3d.gd" id="3"]
[ext_resource type="Material" uid="uid://o14qjpog3k6b" path="res://assets/projectile_1_material.tres" id="5_oon7m"]

[sub_resource type="GDScript" id="1"]
script/source = "extends Node3D


var time := 0.0

func _ready():
	pass # Replace with function body.


func _process(delta):
	time += delta
	$shape.material_override.set_shader_parameter('time', time)
"

[sub_resource type="Shader" id="2"]
code = "shader_type spatial;

uniform vec4 color : source_color = vec4(1.0);
uniform float speed = -1.0;
uniform float time = 0.0;
uniform sampler2D base: source_color;

varying vec2 uv;
void vertex(){
	uv = vec2(UV.x+time*speed, UV.y);
}

void fragment(){
	float a = texture(base, uv).a;
	
	EMISSION = color.rgb*2.0;
	ALPHA = clamp(a * color.a * 1.5 - 0.3, 0.0, 1.0);
}"

[sub_resource type="ShaderMaterial" id="3"]
render_priority = 0
shader = SubResource("2")
shader_parameter/color = Color(0, 0.505882, 1, 1)
shader_parameter/speed = -1.0
shader_parameter/time = 0.0
shader_parameter/base = ExtResource("2")

[sub_resource type="Curve" id="7"]
_data = [Vector2(0, 0.157084), 0.0, 4.82292, 0, 0, Vector2(0.374581, 1), 0.0, 0.0, 0, 0]
point_count = 2

[sub_resource type="Gradient" id="8"]
offsets = PackedFloat32Array(0, 0.210046, 0.56621, 1)
colors = PackedColorArray(0.691406, 0.691406, 0.691406, 1, 0, 0.305511, 0.832031, 1, 0.996094, 0.962288, 0.602714, 1, 0.992188, 0.986368, 0.980173, 0)

[node name="projectile" type="Node3D"]
script = SubResource("1")

[node name="shape" type="MeshInstance3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0.752557)
material_override = SubResource("3")
mesh = ExtResource("1")

[node name="trail" type="Node3D" parent="."]
script = ExtResource("3")
distance = 0.5
segments = 25
lifetime = 2.0
base_width = 1.9
width_profile = SubResource("7")
color_gradient = SubResource("8")
material = ExtResource("5_oon7m")
